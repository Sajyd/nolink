"use strict";var y=Object.create;var d=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var R=Object.getPrototypeOf,v=Object.prototype.hasOwnProperty;var A=(t,e)=>{for(var n in e)d(t,n,{get:e[n],enumerable:!0})},f=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of E(e))!v.call(t,o)&&o!==n&&d(t,o,{get:()=>e[o],enumerable:!(r=S(e,o))||r.enumerable});return t};var P=(t,e,n)=>(n=t!=null?y(R(t)):{},f(e||!t||!t.__esModule?d(n,"default",{value:t,enumerable:!0}):n,t)),x=t=>f(d({},"__esModule",{value:!0}),t);var B={};A(B,{NolinkAccessButton:()=>I,useNolink:()=>$});module.exports=x(B);var i=P(require("react"));var T="https://nolink.ai",m="nolink_token",p=null,U=null,C=null;function g(t){if(!t?.partnerKey?.trim())throw new Error("nolink-sdk: partnerKey est requis");let e=(t.baseUrl??T).replace(/\/$/,"");if(!e.startsWith("https://")&&!e.startsWith("http://localhost"))throw new Error("nolink-sdk: baseUrl doit \xEAtre en HTTPS (ou localhost en dev)");p={...t,baseUrl:e}}function N(){if(!p)throw new Error("nolink-sdk: appelle init() avant d'utiliser le SDK");return p}function h(t,e={}){let n=N(),r=t.trim();if(!r)throw new Error("nolink-sdk: serviceId requis");let o=e.buttonText??"Acc\xE8s imm\xE9diat",c=e.color??n.primaryColor??"#6366f1",s=document.createElement("button");s.type="button",s.textContent=o,s.style.cssText=`
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    font-weight: 500;
    font-size: 0.875rem;
    background-color: ${c};
    color: white;
    border: none;
    cursor: pointer;
  `,s.setAttribute("data-nolink-button",r),s.addEventListener("click",()=>{let l=window.location.href,u=new URLSearchParams;u.set("embed","1"),u.set("return_url",l),e.planId&&u.set("plan",e.planId);let k=`${n.baseUrl}/s/${encodeURIComponent(r)}?${u.toString()}`;window.location.href=k});let a=e.mountTarget;if(a){let l=typeof a=="string"?document.querySelector(a):a;l&&l.appendChild(s)}return s}function w(){if(typeof window>"u")return null;let e=new URLSearchParams(window.location.search).get(m);if(!e)return null;try{let n=_(e),r=n.subscription_status,o={userId:n.userId??"",subscriptionStatus:r==="freemium"?"freemium":"active",token:e};U?.(o);let c=new URL(window.location.href);return c.searchParams.delete(m),window.history.replaceState({},"",c.toString()),o}catch{return C?.({code:"INVALID_TOKEN",message:"Token invalide ou expir\xE9"}),null}}function _(t){let e=t.split(".");if(e.length!==3)throw new Error("Invalid JWT");let n=e[1].replace(/-/g,"+").replace(/_/g,"/"),r=atob(n);return JSON.parse(r)}var b=require("react/jsx-runtime");function I({serviceId:t,...e}){let n=i.useRef(null);return i.useEffect(()=>{if(!n.current)return;let r=h(t,{...e,mountTarget:n.current});return()=>r.remove()},[t,e.buttonText,e.planId,e.color]),(0,b.jsx)("div",{ref:n,"data-nolink-react":!0})}function $(t){i.useEffect(()=>{t&&g(t)},[t?.partnerKey,t?.baseUrl]),i.useEffect(()=>{w()},[])}0&&(module.exports={NolinkAccessButton,useNolink});
