var h="https://nolink.ai",m="nolink_token",a=null,f=null,p=null;function b(t){if(!t?.partnerKey?.trim())throw new Error("nolink-sdk: partnerKey est requis");let e=(t.baseUrl??h).replace(/\/$/,"");if(!e.startsWith("https://")&&!e.startsWith("http://localhost"))throw new Error("nolink-sdk: baseUrl doit \xEAtre en HTTPS (ou localhost en dev)");a={...t,baseUrl:e}}function d(){if(!a)throw new Error("nolink-sdk: appelle init() avant d'utiliser le SDK");return a}function S(t,e={}){let s=d(),r=t.trim();if(!r)throw new Error("nolink-sdk: serviceId requis");let n=e.buttonText??"Acc\xE8s imm\xE9diat",i=e.color??s.primaryColor??"#6366f1",o=document.createElement("button");o.type="button",o.textContent=n,o.style.cssText=`
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    font-weight: 500;
    font-size: 0.875rem;
    background-color: ${i};
    color: white;
    border: none;
    cursor: pointer;
  `,o.setAttribute("data-nolink-button",r),o.addEventListener("click",()=>{let l=window.location.href,u=new URLSearchParams;u.set("embed","1"),u.set("return_url",l),e.planId&&u.set("plan",e.planId);let g=`${s.baseUrl}/s/${encodeURIComponent(r)}?${u.toString()}`;window.location.href=g});let c=e.mountTarget;if(c){let l=typeof c=="string"?document.querySelector(c):c;l&&l.appendChild(o)}return o}function y(t){f=t}function k(t){p=t}function E(){if(typeof window>"u")return null;let e=new URLSearchParams(window.location.search).get(m);if(!e)return null;try{let s=w(e),r=s.subscription_status,n={userId:s.userId??"",subscriptionStatus:r==="freemium"?"freemium":"active",token:e};f?.(n);let i=new URL(window.location.href);return i.searchParams.delete(m),window.history.replaceState({},"",i.toString()),n}catch{return p?.({code:"INVALID_TOKEN",message:"Token invalide ou expir\xE9"}),null}}function w(t){let e=t.split(".");if(e.length!==3)throw new Error("Invalid JWT");let s=e[1].replace(/-/g,"+").replace(/_/g,"/"),r=atob(s);return JSON.parse(r)}async function v(t,e={}){let r=d().baseUrl.replace(/\/$/,""),n=new URLSearchParams;n.set("slug",t),e.token&&n.set("token",e.token),e.limit&&n.set("limit",String(e.limit));let i=`${r}/api/ai/recommend?${n.toString()}`,o=await fetch(i,{method:"GET",headers:{Accept:"application/json"}});if(!o.ok){let c=await o.json().catch(()=>({error:o.statusText}));return p?.({code:"RECOMMEND_FAILED",message:c.error??"Erreur recommandations"}),[]}return o.json()}async function P(t){let r=`${d().baseUrl.replace(/\/$/,"")}/api/access/verify?token=${encodeURIComponent(t)}`,n=await fetch(r,{method:"GET",headers:{Accept:"application/json"}});return n.ok?n.json():null}function A(t,e){let s=d(),r=typeof window<"u"?window.location.href:"",n=new URLSearchParams;return n.set("embed","1"),r&&n.set("return_url",r),`${s.baseUrl}/s/${encodeURIComponent(t)}?${n.toString()}`}function R(){return a?{...a}:null}export{b as a,S as b,y as c,k as d,E as e,v as f,P as g,A as h,R as i};
