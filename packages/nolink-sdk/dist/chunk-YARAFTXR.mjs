var h="https://nolink.ai",m="nolink_token",c=null,f=null,p=null;function b(t){if(!t?.partnerKey?.trim())throw new Error("nolink-sdk: partnerKey est requis");let e=(t.baseUrl??h).replace(/\/$/,"");if(!e.startsWith("https://")&&!e.startsWith("http://localhost"))throw new Error("nolink-sdk: baseUrl doit \xEAtre en HTTPS (ou localhost en dev)");c={...t,baseUrl:e}}function u(){if(!c)throw new Error("nolink-sdk: appelle init() avant d'utiliser le SDK");return c}function S(t,e={}){let s=u(),r=t.trim();if(!r)throw new Error("nolink-sdk: serviceId requis");let n=e.buttonText??"Acc\xE8s imm\xE9diat",d=e.color??s.primaryColor??"#6366f1",o=document.createElement("button");o.type="button",o.textContent=n,o.style.cssText=`
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    font-weight: 500;
    font-size: 0.875rem;
    background-color: ${d};
    color: white;
    border: none;
    cursor: pointer;
  `,o.setAttribute("data-nolink-button",r),o.addEventListener("click",()=>{let a=window.location.href,l=new URLSearchParams;l.set("embed","1"),l.set("return_url",a),e.planId&&l.set("plan",e.planId);let g=`${s.baseUrl}/s/${encodeURIComponent(r)}?${l.toString()}`;window.location.href=g});let i=e.mountTarget;if(i){let a=typeof i=="string"?document.querySelector(i):i;a&&a.appendChild(o)}return o}function y(t){f=t}function k(t){p=t}function E(){if(typeof window>"u")return null;let e=new URLSearchParams(window.location.search).get(m);if(!e)return null;try{let s=w(e),r={userId:s.userId??"",subscriptionStatus:s.subscription_status??"active",token:e};f?.(r);let n=new URL(window.location.href);return n.searchParams.delete(m),window.history.replaceState({},"",n.toString()),r}catch{return p?.({code:"INVALID_TOKEN",message:"Token invalide ou expir\xE9"}),null}}function w(t){let e=t.split(".");if(e.length!==3)throw new Error("Invalid JWT");let s=e[1].replace(/-/g,"+").replace(/_/g,"/"),r=atob(s);return JSON.parse(r)}async function v(t,e={}){let r=u().baseUrl.replace(/\/$/,""),n=new URLSearchParams;n.set("slug",t),e.token&&n.set("token",e.token),e.limit&&n.set("limit",String(e.limit));let d=`${r}/api/ai/recommend?${n.toString()}`,o=await fetch(d,{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(!o.ok){let i=await o.json().catch(()=>({error:o.statusText}));return p?.({code:"RECOMMEND_FAILED",message:i.error??"Erreur recommandations"}),[]}return o.json()}async function P(t){let r=`${u().baseUrl.replace(/\/$/,"")}/api/access/verify?token=${encodeURIComponent(t)}`,n=await fetch(r,{method:"GET",headers:{Accept:"application/json"}});return n.ok?n.json():null}function A(t,e){let s=u(),r=typeof window<"u"?window.location.href:"",n=new URLSearchParams;return n.set("embed","1"),r&&n.set("return_url",r),`${s.baseUrl}/s/${encodeURIComponent(t)}?${n.toString()}`}function R(){return c?{...c}:null}export{b as a,S as b,y as c,k as d,E as e,v as f,P as g,A as h,R as i};
