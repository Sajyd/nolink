"use strict";var Nolink=(()=>{var p=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var S=Object.prototype.hasOwnProperty;var y=(t,e)=>{for(var o in e)p(t,o,{get:e[o],enumerable:!0})},k=(t,e,o,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of b(e))!S.call(t,n)&&n!==o&&p(t,n,{get:()=>e[n],enumerable:!(r=w(e,n))||r.enumerable});return t};var E=t=>k(p({},"__esModule",{value:!0}),t);var N={};y(N,{getConfig:()=>I,getEmbedUrl:()=>$,handleReturnToken:()=>x,init:()=>P,onAccessError:()=>U,onSubscriptionSuccess:()=>R,recommendNextServices:()=>_,showAccessButton:()=>A,verifyToken:()=>C});var v="https://nolink.ai",f="nolink_token",a=null,g=null,m=null;function P(t){if(!t?.partnerKey?.trim())throw new Error("nolink-sdk: partnerKey est requis");let e=(t.baseUrl??v).replace(/\/$/,"");if(!e.startsWith("https://")&&!e.startsWith("http://localhost"))throw new Error("nolink-sdk: baseUrl doit \xEAtre en HTTPS (ou localhost en dev)");a={...t,baseUrl:e}}function d(){if(!a)throw new Error("nolink-sdk: appelle init() avant d'utiliser le SDK");return a}function A(t,e={}){let o=d(),r=t.trim();if(!r)throw new Error("nolink-sdk: serviceId requis");let n=e.buttonText??"Acc\xE8s imm\xE9diat",i=e.color??o.primaryColor??"#6366f1",s=document.createElement("button");s.type="button",s.textContent=n,s.style.cssText=`
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    font-weight: 500;
    font-size: 0.875rem;
    background-color: ${i};
    color: white;
    border: none;
    cursor: pointer;
  `,s.setAttribute("data-nolink-button",r),s.addEventListener("click",()=>{let l=window.location.href,u=new URLSearchParams;u.set("embed","1"),u.set("return_url",l),e.planId&&u.set("plan",e.planId);let h=`${o.baseUrl}/s/${encodeURIComponent(r)}?${u.toString()}`;window.location.href=h});let c=e.mountTarget;if(c){let l=typeof c=="string"?document.querySelector(c):c;l&&l.appendChild(s)}return s}function R(t){g=t}function U(t){m=t}function x(){if(typeof window>"u")return null;let e=new URLSearchParams(window.location.search).get(f);if(!e)return null;try{let o=T(e),r=o.subscription_status,n={userId:o.userId??"",subscriptionStatus:r==="freemium"?"freemium":"active",token:e};g?.(n);let i=new URL(window.location.href);return i.searchParams.delete(f),window.history.replaceState({},"",i.toString()),n}catch{return m?.({code:"INVALID_TOKEN",message:"Token invalide ou expir\xE9"}),null}}function T(t){let e=t.split(".");if(e.length!==3)throw new Error("Invalid JWT");let o=e[1].replace(/-/g,"+").replace(/_/g,"/"),r=atob(o);return JSON.parse(r)}async function _(t,e={}){let r=d().baseUrl.replace(/\/$/,""),n=new URLSearchParams;n.set("slug",t),e.token&&n.set("token",e.token),e.limit&&n.set("limit",String(e.limit));let i=`${r}/api/ai/recommend?${n.toString()}`,s=await fetch(i,{method:"GET",headers:{Accept:"application/json"}});if(!s.ok){let c=await s.json().catch(()=>({error:s.statusText}));return m?.({code:"RECOMMEND_FAILED",message:c.error??"Erreur recommandations"}),[]}return s.json()}async function C(t){let r=`${d().baseUrl.replace(/\/$/,"")}/api/access/verify?token=${encodeURIComponent(t)}`,n=await fetch(r,{method:"GET",headers:{Accept:"application/json"}});return n.ok?n.json():null}function $(t,e){let o=d(),r=typeof window<"u"?window.location.href:"",n=new URLSearchParams;return n.set("embed","1"),r&&n.set("return_url",r),`${o.baseUrl}/s/${encodeURIComponent(t)}?${n.toString()}`}function I(){return a?{...a}:null}return E(N);})();
